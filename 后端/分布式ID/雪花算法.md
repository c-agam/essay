**简介**

雪花算法(snowflake)是twitter开源的分布式ID生成算法，这个算法单机每秒内理论上最多可以生成1000*(2^12)，也就是400W的ID，完全能满足业务的需求。

```
// 64位long的ID

1、符号位：1位，始终为0，不可用

2、时间序列：41位，精确到毫秒级，41位的长度可以使用69年

3、机器标识：10位，最多支持部署1024个节点

4、计数序列号：12位，可以支持同一节点同一毫秒生成多个ID序号，12位的计数序列号支持每个节点每毫秒产生4096个ID序号。

```
**缺点**

由于“没有一个全局时钟”，每台服务器分配的ID是绝对递增的，但从全局看，生成的ID只是趋势递增的（有些服务器的时间早，有些服务器的时间晚）

**一个容易忽略的问题：**

生成的ID，例如message-id/order-id/tiezi-id，在数据量大时往往需要分库分表，这些ID经常作为取模分库分表的依据，为了分库分表后数据均匀，ID生成往往有“取模随机性”的需求，所以我们通常把每秒内的序列号放在ID的最末位，保证生成的ID是随机的。如果我们在跨毫秒时，序列号总是归0，会使得序列号为0的ID比较多，导致生成的ID取模后不均匀。解决方法是，序列号不是每次都归0，而是归一个0到9的随机数。

**参考**
* [美团](https://tech.meituan.com/2017/04/21/mt-leaf.html)
* [百度](https://github.com/baidu/uid-generator)
